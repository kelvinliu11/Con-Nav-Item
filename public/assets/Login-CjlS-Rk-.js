var h=(m,i,o)=>new Promise((l,s)=>{var d=e=>{try{r(o.next(e))}catch(t){s(t)}},v=e=>{try{r(o.throw(e))}catch(t){s(t)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(d,v);r((o=o.apply(m,i)).next())});import{_ as w,r as c,b as n,e as a,w as b,h as y,s as _,v as g,t as k,B as x,d as u}from"./index-dh0l1nv0.js";import{U as S}from"./api-tI8btTuo.js";const B={class:"login-container"},C={class:"login-box"},U={class:"form-group"},V=["disabled"],D={class:"form-group"},I=["disabled"],L={key:0,class:"error-message"},N=["disabled"],q={key:0},z={key:1},A={__name:"Login",setup(m){const i=x(),o=c(!1),l=c(""),s=c({username:"",password:""}),d=()=>{if(!s.value.username||s.value.username.length<3)return l.value="用户名至少 3 个字符",!1;if(!s.value.username.match(/^[a-zA-Z0-9_]+$/))return l.value="用户名只能包含字母、数字和下划线",!1;if(s.value.username.length>20)return l.value="用户名最多 20 个字符",!1;if(!s.value.password||s.value.password.length<8)return l.value="密码至少 8 个字符",!1;if(s.value.password.length>128)return l.value="密码最多 128 个字符",!1;const r=/[A-Z]/.test(s.value.password),e=/[a-z]/.test(s.value.password),t=/\d/.test(s.value.password),p=/[!@#$%^&*(),.?":{}|<>_\-+=[\]\\;'/`~]/.test(s.value.password);return[r,e,t,p].filter(Boolean).length<3?(l.value="密码必须包含以下至少 3 种：大写字母、小写字母、数字、特殊字符",!1):!0},v=()=>h(null,null,function*(){var r,e;if(d()){o.value=!0,l.value="";try{const t=yield S(s.value.username,s.value.password);localStorage.setItem("token",t.data.token),localStorage.setItem("username",s.value.username),"caches"in window&&caches.keys().then(p=>{p.forEach(f=>{caches.delete(f)})}),i.push("/")}catch(t){l.value=((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.error)||t.message||"操作失败，请重试"}finally{o.value=!1}}});return(r,e)=>(u(),n("div",B,[a("div",C,[e[4]||(e[4]=a("div",{class:"login-header"},[a("h1",null,"欢迎回来"),a("p",{class:"subtitle"},"输入用户名和密码开始使用")],-1)),a("form",{onSubmit:b(v,["prevent"]),class:"login-form"},[a("div",U,[e[2]||(e[2]=a("label",{for:"username"},"用户名",-1)),_(a("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=t=>s.value.username=t),type:"text",placeholder:"请输入用户名",required:"",disabled:o.value},null,8,V),[[g,s.value.username]])]),a("div",D,[e[3]||(e[3]=a("label",{for:"password"},"密码",-1)),_(a("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=t=>s.value.password=t),type:"password",placeholder:"请输入密码",required:"",disabled:o.value},null,8,I),[[g,s.value.password]])]),l.value?(u(),n("div",L,k(l.value),1)):y("",!0),a("button",{type:"submit",class:"submit-btn",disabled:o.value},[o.value?(u(),n("span",q,"处理中...")):(u(),n("span",z,"登录 / 注册"))],8,N)],32),e[5]||(e[5]=a("div",{class:"password-hint"},[a("h4",null,"密码要求："),a("ul",null,[a("li",null,"至少 8 个字符"),a("li",null,"包含以下至少 3 种：大写字母、小写字母、数字、特殊字符")])],-1))])]))}},$=w(A,[["__scopeId","data-v-1217527c"]]);export{$ as default};
