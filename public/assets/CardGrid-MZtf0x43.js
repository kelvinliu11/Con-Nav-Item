import{_ as G,r as c,o as K,a as V,b as u,d as r,f as j,F as A,g as F,w as b,i as X,e as t,h,t as w,n as Y,T as q}from"./index-D1i49eai.js";const H=["data-card-id","onContextmenu","onClick"],J=["href","title","onClick"],Q=["src","onError"],W={class:"link-text"},Z={key:0,class:"card-selected-badge"},ee={__name:"CardGrid",props:{cards:Array,selectedCards:Array,categoryId:Number,subCategoryId:[Number,null]},emits:["contextEdit","contextDelete","toggleCardSelection","openMovePanel","requireAuth"],setup(g,{emit:E}){const M=g,a=E,S=c(null),d=c(!1),v=c(0),x=c(0),l=c(null);function _(e,n){l.value=n,v.value=e.clientX,x.value=e.clientY,d.value=!0}function s(){d.value=!1,l.value=null}function D(){l.value&&a("contextEdit",l.value),s()}function I(){l.value&&a("contextDelete",l.value),s()}function L(){l.value&&a("toggleCardSelection",l.value),s()}function z(){l.value&&(m(l.value)||a("toggleCardSelection",l.value),a("openMovePanel")),s()}function O(){l.value&&(k(l.value.id),window.open(l.value.url,"_blank")),s()}function $(){l.value&&navigator.clipboard.writeText(l.value.url),s()}function C(e){d.value&&s()}function P(e,n){(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),a("toggleCardSelection",n))}function U(e,n){e.ctrlKey||e.metaKey?(e.preventDefault(),e.stopPropagation()):k(n.id)}function k(e){fetch(`/api/cards/${e}/click`,{method:"POST"}).catch(()=>{})}K(()=>{document.addEventListener("click",C),document.addEventListener("scroll",s)}),V(()=>{document.removeEventListener("click",C),document.removeEventListener("scroll",s)});function y(e){try{return new URL(e).origin}catch(n){return null}}function N(e){if(e.logo_url)return e.logo_url;const n=y(e.url);return n?`https://api.xinac.net/icon/?url=${n}&sz=128`:"/default-favicon.png"}const f=[e=>`https://api.xinac.net/icon/?url=${e}&sz=128`,e=>`https://api.afmax.cn/so/ico/index.php?r=${e}&sz=128`,e=>`https://icon.horse/icon/${e}`,e=>`https://www.google.com/s2/favicons?domain=${e}&sz=128`,e=>`https://favicon.im/${e}?larger=true`];function R(e,n){const o=e.target.src,p=y(n.url);if(!p){e.target.src="/default-favicon.png";return}e.target._cdnIndex===void 0&&(e.target._cdnIndex=0);for(let i=0;i<f.length;i++)if(f[i](p),o.includes("api.xinac.net")&&i===0||o.includes("api.afmax.cn")&&i===1||o.includes("icon.horse")&&i===2||o.includes("www.google.com/s2/favicons")&&i===3||o.includes("favicon.im")&&i===4){if(i+1<f.length){e.target._cdnIndex=i+1,e.target.src=f[i+1](p);return}break}e.target.src="/default-favicon.png"}function T(e){let n="";return e.desc&&(n+=e.desc+`
`),e.tags&&e.tags.length>0&&(n+="æ ‡ç­¾: "+e.tags.map(o=>o.name).join(", ")+`
`),n+=e.url,n}function B(e){return e?e.length>20?e.slice(0,20)+"...":e:""}function m(e){var n;return((n=M.selectedCards)==null?void 0:n.some(o=>o.id===e.id))||!1}return(e,n)=>(r(),u("div",{ref_key:"cardGridRef",ref:S,class:"container card-grid"},[(r(!0),u(A,null,F(g.cards,(o,p)=>(r(),u("div",{key:o.id,class:X(["link-item",{selected:m(o)}]),"data-card-id":o.id,onContextmenu:b(i=>_(i,o),["prevent"]),onClick:i=>P(i,o)},[t("a",{href:o.url,target:"_blank",title:T(o),onClick:i=>U(i,o),class:"card-link"},[t("img",{class:"link-icon",src:N(o),alt:"",onError:i=>R(i,o),loading:"lazy"},null,40,Q),t("span",W,w(B(o.title)),1)],8,J),m(o)?(r(),u("div",Z,"âœ“")):h("",!0)],42,H))),128)),(r(),j(q,{to:"body"},[d.value?(r(),u("div",{key:0,class:"context-menu",style:Y({left:v.value+"px",top:x.value+"px"}),onClick:n[0]||(n[0]=b(()=>{},["stop"]))},[t("div",{class:"context-menu-item",onClick:D},[...n[1]||(n[1]=[t("span",{class:"context-menu-icon"},"âœï¸",-1),t("span",null,"ç¼–è¾‘",-1)])]),t("div",{class:"context-menu-item",onClick:I},[...n[2]||(n[2]=[t("span",{class:"context-menu-icon"},"ğŸ—‘ï¸",-1),t("span",null,"åˆ é™¤",-1)])]),n[7]||(n[7]=t("div",{class:"context-menu-divider"},null,-1)),t("div",{class:"context-menu-item",onClick:L},[n[3]||(n[3]=t("span",{class:"context-menu-icon"},"â˜‘ï¸",-1)),t("span",null,w(m(l.value)?"å–æ¶ˆé€‰ä¸­":"é€‰ä¸­"),1)]),t("div",{class:"context-menu-item",onClick:z},[...n[4]||(n[4]=[t("span",{class:"context-menu-icon"},"ğŸ“",-1),t("span",null,"ç§»åŠ¨åˆ°...",-1)])]),n[8]||(n[8]=t("div",{class:"context-menu-divider"},null,-1)),t("div",{class:"context-menu-item",onClick:O},[...n[5]||(n[5]=[t("span",{class:"context-menu-icon"},"ğŸ”—",-1),t("span",null,"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€",-1)])]),t("div",{class:"context-menu-item",onClick:$},[...n[6]||(n[6]=[t("span",{class:"context-menu-icon"},"ğŸ“‹",-1),t("span",null,"å¤åˆ¶é“¾æ¥",-1)])])],4)):h("",!0)]))],512))}},te=G(ee,[["__scopeId","data-v-2debb5e3"]]);export{te as default};
