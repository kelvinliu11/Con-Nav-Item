var f=(m,i,r)=>new Promise((l,s)=>{var d=e=>{try{o(r.next(e))}catch(t){s(t)}},v=e=>{try{o(r.throw(e))}catch(t){s(t)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(d,v);o((r=r.apply(m,i)).next())});import{_ as g,r as p,b as n,e as a,w,h as b,s as c,v as h,t as y,B as k,d as u}from"./index-CZB-rz6S.js";import{U as x}from"./api-BAkBujP7.js";const S={class:"login-container"},B={class:"login-box"},U={class:"form-group"},C=["disabled"],N={class:"form-group"},V=["disabled"],D={key:0,class:"error-message"},I=["disabled"],L={key:0},q={key:1},z={__name:"Login",setup(m){const i=k(),r=p(!1),l=p(""),s=p({username:"",password:""}),d=()=>{if(!s.value.username||s.value.username.length<3)return l.value="用户名至少 3 个字符",!1;if(!s.value.username.match(/^[a-zA-Z0-9_]+$/))return l.value="用户名只能包含字母、数字和下划线",!1;if(s.value.username.length>20)return l.value="用户名最多 20 个字符",!1;if(!s.value.password||s.value.password.length<8)return l.value="密码至少 8 个字符",!1;if(s.value.password.length>128)return l.value="密码最多 128 个字符",!1;const o=/[A-Z]/.test(s.value.password),e=/[a-z]/.test(s.value.password),t=/\d/.test(s.value.password),_=/[!@#$%^&*(),.?":{}|<>_\-+=[\]\\;'/`~]/.test(s.value.password);return[o,e,t,_].filter(Boolean).length<3?(l.value="密码必须包含以下至少 3 种：大写字母、小写字母、数字、特殊字符",!1):!0},v=()=>f(null,null,function*(){var o,e;if(d()){r.value=!0,l.value="";try{const t=yield x(s.value.username,s.value.password);localStorage.setItem("token",t.data.token),localStorage.setItem("username",s.value.username),t.data.isNewUser&&alert("欢迎新用户！已自动为您创建账号"),i.push("/")}catch(t){l.value=((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.error)||t.message||"操作失败，请重试"}finally{r.value=!1}}});return(o,e)=>(u(),n("div",S,[a("div",B,[e[4]||(e[4]=a("div",{class:"login-header"},[a("h1",null,"欢迎回来"),a("p",{class:"subtitle"},"输入用户名和密码开始使用")],-1)),a("form",{onSubmit:w(v,["prevent"]),class:"login-form"},[a("div",U,[e[2]||(e[2]=a("label",{for:"username"},"用户名",-1)),c(a("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=t=>s.value.username=t),type:"text",placeholder:"请输入用户名",required:"",disabled:r.value},null,8,C),[[h,s.value.username]])]),a("div",N,[e[3]||(e[3]=a("label",{for:"password"},"密码",-1)),c(a("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=t=>s.value.password=t),type:"password",placeholder:"请输入密码",required:"",disabled:r.value},null,8,V),[[h,s.value.password]])]),l.value?(u(),n("div",D,y(l.value),1)):b("",!0),a("button",{type:"submit",class:"submit-btn",disabled:r.value},[r.value?(u(),n("span",L,"处理中...")):(u(),n("span",q,"登录 / 注册"))],8,I)],32),e[5]||(e[5]=a("div",{class:"password-hint"},[a("h4",null,"密码要求："),a("ul",null,[a("li",null,"至少 8 个字符"),a("li",null,"包含以下至少 3 种：大写字母、小写字母、数字、特殊字符")])],-1))])]))}},E=g(z,[["__scopeId","data-v-34bf9910"]]);export{E as default};
