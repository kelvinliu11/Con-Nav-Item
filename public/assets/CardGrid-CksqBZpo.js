import{_ as ue,r as d,o as ce,a as de,w as fe,b as m,d as u,f as U,F as me,h as ve,k as X,j as Y,i as ge,e as s,g as w,t as z,T as $,n as K}from"./index-B7_2GqFm.js";import{S as pe}from"./Home-BoRLVj6f.js";import"./urlNormalizer-qgomC143.js";const xe=["data-card-id","onContextmenu","onMousedown","onTouchstart","onClick"],he=["href","target","title"],Ce=["src","onError"],ye={class:"link-text"},ke={key:0,class:"card-selected-badge"},be={key:0,class:"drag-hint"},j=500,Ee={__name:"CardGrid",props:{cards:Array,selectedCards:Array,categoryId:Number,subCategoryId:[Number,null]},emits:["cardsReordered","contextEdit","contextDelete","toggleCardSelection","openMovePanel"],setup(D,{emit:A}){const C=D,c=A,S=d(null);let f=null;const y=d(!1),I=d(0),O=d(0),i=d(null),r=d(!1),v=d(!1);let g=null,k=null;function G(e,t){i.value=t,I.value=e.clientX,O.value=e.clientY,y.value=!0}function a(){y.value=!1,i.value=null}function B(){i.value&&c("contextEdit",i.value),a()}function V(){i.value&&c("contextDelete",i.value),a()}function F(){i.value&&c("toggleCardSelection",i.value),a()}function J(){i.value&&(E(i.value)||c("toggleCardSelection",i.value),c("openMovePanel")),a()}function q(){i.value&&window.open(i.value.url,"_blank"),a()}function H(){i.value&&navigator.clipboard.writeText(i.value.url),a()}function _(e){y.value&&a()}function Q(e,t){(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),c("toggleCardSelection",t))}function W(e){(r.value||e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation())}function Z(e,t){if(e.button!==0||e.ctrlKey||e.metaKey)return;k=t;const o=e.clientX,l=e.clientY;g=setTimeout(()=>{v.value=!0,N()},j);const n=h=>{const T=Math.abs(h.clientX-o),M=Math.abs(h.clientY-l);(T>5||M>5)&&p()},x=()=>{p(),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",x)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",x)}function ee(e,t){k=t;const o=e.touches[0],l=o.clientX,n=o.clientY;g=setTimeout(()=>{v.value=!0,N()},j);const x=T=>{const M=T.touches[0],ae=Math.abs(M.clientX-l),re=Math.abs(M.clientY-n);(ae>10||re>10)&&p()},h=()=>{p(),document.removeEventListener("touchmove",x),document.removeEventListener("touchend",h)};document.addEventListener("touchmove",x,{passive:!0}),document.addEventListener("touchend",h)}function p(){g&&(clearTimeout(g),g=null),v.value=!1}function N(){r.value=!0,v.value=!1,P(),setTimeout(()=>{if(!f)return;const e=S.value;if(!e||!k)return;const t=e.querySelector(`[data-card-id="${k.id}"]`);t&&t.classList.add("sortable-chosen")},50)}function te(){r.value=!1,L()}function P(){if(f)return;const e=S.value;e&&(f=new pe(e,{animation:150,group:"cards",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",delay:0,delayOnTouchOnly:!1,onStart:()=>{r.value=!0},onEnd:t=>{const o=t.to,l=Array.from(o.children).map(n=>parseInt(n.getAttribute("data-card-id"))).filter(n=>!isNaN(n));c("cardsReordered",l,C.categoryId,C.subCategoryId),setTimeout(()=>{te()},100)}}))}function L(){f&&(f.destroy(),f=null)}ce(()=>{document.addEventListener("click",_),document.addEventListener("scroll",a)}),de(()=>{document.removeEventListener("click",_),document.removeEventListener("scroll",a),L(),p()}),fe(()=>C.cards,(e,t)=>{e&&e.length>0&&(!t||t.length===0||JSON.stringify(e)!==JSON.stringify(t))&&K(()=>{r.value&&(L(),K(()=>P()))})},{deep:!0,immediate:!1});function ne(e){return{}}function R(e){try{return new URL(e).origin}catch(t){return null}}function oe(e){if(e.logo_url)return e.logo_url;const t=R(e.url);return t?`https://api.xinac.net/icon/?url=${t}&sz=128`:"/default-favicon.png"}const b=[e=>`https://api.xinac.net/icon/?url=${e}&sz=128`,e=>`https://api.afmax.cn/so/ico/index.php?r=${e}&sz=128`,e=>`https://icon.horse/icon/${e}`,e=>`https://www.google.com/s2/favicons?domain=${e}&sz=128`,e=>`https://favicon.im/${e}?larger=true`];function se(e,t){const o=e.target.src,l=R(t.url);if(!l){e.target.src="/default-favicon.png";return}e.target._cdnIndex===void 0&&(e.target._cdnIndex=0);for(let n=0;n<b.length;n++)if(b[n](l),o.includes("api.xinac.net")&&n===0||o.includes("api.afmax.cn")&&n===1||o.includes("icon.horse")&&n===2||o.includes("www.google.com/s2/favicons")&&n===3||o.includes("favicon.im")&&n===4){if(n+1<b.length){e.target._cdnIndex=n+1,e.target.src=b[n+1](l);return}break}e.target.src="/default-favicon.png"}function ie(e){let t="";return e.desc&&(t+=e.desc+`
`),e.tags&&e.tags.length>0&&(t+="æ ‡ç­¾: "+e.tags.map(o=>o.name).join(", ")+`
`),t+=e.url,t}function le(e){return e?e.length>20?e.slice(0,20)+"...":e:""}function E(e){var t;return((t=C.selectedCards)==null?void 0:t.some(o=>o.id===e.id))||!1}return(e,t)=>(u(),m("div",{ref_key:"cardGridRef",ref:S,class:"container card-grid"},[(u(!0),m(me,null,ve(D.cards,(o,l)=>(u(),m("div",{key:o.id,class:ge(["link-item",{selected:E(o),dragging:r.value}]),"data-card-id":o.id,style:Y(ne()),onContextmenu:X(n=>G(n,o),["prevent"]),onMousedown:n=>Z(n,o),onTouchstart:n=>ee(n,o),onClick:n=>Q(n,o)},[s("a",{href:r.value?"javascript:void(0)":o.url,target:r.value?"":"_blank",title:ie(o),onClick:t[0]||(t[0]=n=>W(n)),class:"card-link"},[s("img",{class:"link-icon",src:oe(o),alt:"",onError:n=>se(n,o),loading:"lazy"},null,40,Ce),s("span",ye,z(le(o.title)),1)],8,he),E(o)?(u(),m("div",ke,"âœ“")):w("",!0)],46,xe))),128)),(u(),U($,{to:"body"},[y.value?(u(),m("div",{key:0,class:"context-menu",style:Y({left:I.value+"px",top:O.value+"px"}),onClick:t[1]||(t[1]=X(()=>{},["stop"]))},[s("div",{class:"context-menu-item",onClick:B},[...t[2]||(t[2]=[s("span",{class:"context-menu-icon"},"âœï¸",-1),s("span",null,"ç¼–è¾‘",-1)])]),s("div",{class:"context-menu-item",onClick:V},[...t[3]||(t[3]=[s("span",{class:"context-menu-icon"},"ğŸ—‘ï¸",-1),s("span",null,"åˆ é™¤",-1)])]),t[8]||(t[8]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:F},[t[4]||(t[4]=s("span",{class:"context-menu-icon"},"â˜‘ï¸",-1)),s("span",null,z(E(i.value)?"å–æ¶ˆé€‰ä¸­":"é€‰ä¸­"),1)]),s("div",{class:"context-menu-item",onClick:J},[...t[5]||(t[5]=[s("span",{class:"context-menu-icon"},"ğŸ“",-1),s("span",null,"ç§»åŠ¨åˆ°...",-1)])]),t[9]||(t[9]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:q},[...t[6]||(t[6]=[s("span",{class:"context-menu-icon"},"ğŸ”—",-1),s("span",null,"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€",-1)])]),s("div",{class:"context-menu-item",onClick:H},[...t[7]||(t[7]=[s("span",{class:"context-menu-icon"},"ğŸ“‹",-1),s("span",null,"å¤åˆ¶é“¾æ¥",-1)])])],4)):w("",!0)])),(u(),U($,{to:"body"},[v.value?(u(),m("div",be," æ¾å¼€å¼€å§‹æ‹–æ‹½æ’åº ")):w("",!0)]))],512))}},Te=ue(Ee,[["__scopeId","data-v-d3d1d740"]]);export{Te as default};
