var w=(b,f,o)=>new Promise((n,t)=>{var e=u=>{try{v(o.next(u))}catch(l){t(l)}},p=u=>{try{v(o.throw(u))}catch(l){t(l)}},v=u=>u.done?n(u.value):Promise.resolve(u.value).then(e,p);v((o=o.apply(b,f)).next())});import{_ as x,r as c,o as P,b as d,e as a,h as _,t as m,w as V,s as h,v as g,q as y,B as C,d as i}from"./index-D4-Aiq-4.js";import{V as S,W as B,U as M}from"./api-Dh79ofjO.js";const U={class:"login-container"},q={class:"login-box"},I={class:"login-header"},N={class:"subtitle"},z={class:"form-group"},D=["disabled"],L={class:"form-group"},A=["disabled"],R={key:0,class:"form-group"},T=["disabled"],Z={key:1,class:"error-message"},$=["disabled"],E={key:0},F={key:1},W={class:"toggle-mode"},j={key:0},G={key:1},H={key:0,class:"password-hint"},J={__name:"Login",setup(b){const f=C(),o=c(!1),n=c(!1),t=c(""),e=c({username:"",password:"",confirmPassword:""}),p=()=>{o.value=!o.value,t.value="",e.value={username:"",password:"",confirmPassword:""}},v=()=>{if(!e.value.username||e.value.username.length<3)return t.value="用户名至少 3 个字符",!1;if(!e.value.username.match(/^[a-zA-Z0-9_]+$/))return t.value="用户名只能包含字母、数字和下划线",!1;if(e.value.username.length>20)return t.value="用户名最多 20 个字符",!1;if(!e.value.password||e.value.password.length<8)return t.value="密码至少 8 个字符",!1;if(e.value.password.length>128)return t.value="密码最多 128 个字符",!1;const l=/[A-Z]/.test(e.value.password),s=/[a-z]/.test(e.value.password),r=/\d/.test(e.value.password),k=/[!@#$%^&*(),.?":{}|<>_\-+=[\]\\;'/`~]/.test(e.value.password);return[l,s,r,k].filter(Boolean).length<3?(t.value="密码必须包含以下至少 3 种：大写字母、小写字母、数字、特殊字符",!1):o.value&&e.value.password!==e.value.confirmPassword?(t.value="两次输入的密码不一致",!1):!0},u=()=>w(null,null,function*(){var l,s;if(v()){n.value=!0,t.value="";try{if(o.value)yield B(e.value.username,e.value.password),alert("注册成功！请登录"),o.value=!1;else{const r=yield M(e.value.username,e.value.password);localStorage.setItem("token",r.data.token),localStorage.setItem("username",e.value.username),f.push("/")}}catch(r){t.value=((s=(l=r.response)==null?void 0:l.data)==null?void 0:s.error)||r.message||"操作失败，请重试"}finally{n.value=!1}}});return P(()=>w(null,null,function*(){try{(yield S()).data.initialized&&(o.value=!1)}catch(l){console.error("检查初始化状态失败:",l)}})),(l,s)=>(i(),d("div",U,[a("div",q,[a("div",I,[a("h1",null,m(o.value?"注册账号":"欢迎回来"),1),a("p",N,m(o.value?"创建您的个人导航站账号":"登录以访问您的导航站"),1)]),a("form",{onSubmit:V(u,["prevent"]),class:"login-form"},[a("div",z,[s[3]||(s[3]=a("label",{for:"username"},"用户名",-1)),h(a("input",{id:"username","onUpdate:modelValue":s[0]||(s[0]=r=>e.value.username=r),type:"text",placeholder:"请输入用户名",required:"",disabled:n.value},null,8,D),[[g,e.value.username]])]),a("div",L,[s[4]||(s[4]=a("label",{for:"password"},"密码",-1)),h(a("input",{id:"password","onUpdate:modelValue":s[1]||(s[1]=r=>e.value.password=r),type:"password",placeholder:"请输入密码",required:"",disabled:n.value},null,8,A),[[g,e.value.password]])]),o.value?(i(),d("div",R,[s[5]||(s[5]=a("label",{for:"confirmPassword"},"确认密码",-1)),h(a("input",{id:"confirmPassword","onUpdate:modelValue":s[2]||(s[2]=r=>e.value.confirmPassword=r),type:"password",placeholder:"请再次输入密码",required:"",disabled:n.value},null,8,T),[[g,e.value.confirmPassword]])])):_("",!0),t.value?(i(),d("div",Z,m(t.value),1)):_("",!0),a("button",{type:"submit",class:"submit-btn",disabled:n.value},[n.value?(i(),d("span",E,"处理中...")):(i(),d("span",F,m(o.value?"注册":"登录"),1))],8,$)],32),a("div",W,[o.value?(i(),d("span",j,[s[6]||(s[6]=y(" 已有账号？ ",-1)),a("a",{onClick:p,href:"#"},"立即登录")])):(i(),d("span",G,[s[7]||(s[7]=y(" 还没有账号？ ",-1)),a("a",{onClick:p,href:"#"},"立即注册")]))]),o.value?(i(),d("div",H,[...s[8]||(s[8]=[a("h4",null,"密码要求：",-1),a("ul",null,[a("li",null,"至少 8 个字符"),a("li",null,"包含以下至少 3 种：大写字母、小写字母、数字、特殊字符")],-1)])])):_("",!0)])]))}},Y=x(J,[["__scopeId","data-v-191ccd43"]]);export{Y as default};
